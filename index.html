<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Fightzone</title>

  <link rel="icon" type="image/png" sizes="32x32" href="./favicon.png?v=3">

  <!-- Inter -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet" />

  <!-- Site CSS -->
  <link rel="stylesheet" href="./styles.css" />

  <!-- Request page styles (kept here for stability) -->
  <style>
    .page{ display:none; }
    .page.is-active{ display:block; }

    .request-wrap{
      min-height: calc(100vh - 120px);
      display:flex;
      justify-content:center;
      align-items:flex-start;
      padding: 56px 0 80px;
    }

    .request-card{
      width: 100%;
      max-width: 100%;
      background: rgba(10,12,16,.72);
      border: 1px solid rgba(96,165,250,.25);
      border-radius: 12px;
      box-shadow: 0 24px 80px rgba(0,0,0,.55);
      overflow:hidden;
    }

    .request-head{
      padding: 22px 26px 18px;
      border-bottom: 1px solid rgba(96,165,250,.18);
    }

    .request-title{
      margin:0;
      font-size: 22px;
      font-weight: 700;
      color:#eaf0ff;
    }

    .request-sub{
      margin: 6px 0 0;
      font-size: 13px;
      color: rgba(234,240,255,.65);
    }

    .request-body{
      padding: 22px 26px 26px;
    }

    .form-row{ margin-top: 14px; }

    .form-label{
      display:block;
      font-size: 13px;
      font-weight: 600;
      color: rgba(234,240,255,.85);
      margin-bottom: 8px;
    }

    .form-input{
      width:100%;
      height: 44px;
      padding: 0 14px;
      background: #0b0e14;
      border: 1px solid rgba(96,165,250,.18);
      border-radius: 6px;
      color:#fff;
      outline:none;
      font-family: Inter, system-ui, sans-serif;
      font-size: 14px;
      transition: border-color .2s ease, background .2s ease;
    }

    .form-input::placeholder{ color: rgba(255,255,255,.35); }

    .form-input:focus{
      border-color: rgba(96,165,250,.55);
      background:#0d111a;
    }

    .form-help{
      margin-top: 8px;
      font-size: 12px;
      color: rgba(234,240,255,.55);
    }

    .type-row{
      display:flex;
      gap: 22px;
      align-items:center;
      margin-top: 8px;
      color: rgba(234,240,255,.75);
      font-size: 14px;
    }

    .type-row input{ transform: translateY(1px); }

    .request-actions{ margin-top: 22px; }

    .request-btn{
      width:100%;
      height: 44px;
      border-radius: 6px;
      border: 0;
      cursor:pointer;
      background: rgba(37,99,235,.35);
      color:#eaf0ff;
      font-weight: 600;
      font-family: Inter, system-ui, sans-serif;
      transition: background .2s ease, transform .05s ease;
    }

    .request-btn:hover{ background: rgba(37,99,235,.5); }
    .request-btn:active{ transform: translateY(1px); }

    .request-stack{
      width: 100%;
      max-width: 760px;
      display:flex;
      flex-direction:column;
      gap: 28px;
      margin: 0 auto;
      min-width:0;
    }
</style>
</head>

<body>
<!-- STREAM SCREEN (overlay) -->
<div class="stream-overlay" id="streamOverlay">
  <!-- LEFT: VIDEO + INFO -->
  <div class="stream-main">
    <div class="stream-video">
      <div class="stream-player-box">
        <video id="liveVideo" controls autoplay muted playsinline webkit-playsinline></video>

        <!-- TAP TO PLAY (mobile autoplay fallback) -->
        <div class="tap-to-play" id="tapToPlay">
          <button class="tap-to-play__btn" id="tapToPlayBtn" type="button">Tap to play</button>
        </div>

        <!-- PLACEHOLDER -->
        <div class="stream-placeholder" id="streamPlaceholder">
          <div class="ph-title" id="phTitle">This event is not live yet</div>
          <div class="ph-timer" id="phTimer">--</div>
          <div class="ph-sub" id="phSub">Starting soon</div>
        </div>
      </div>
    </div>

    <div class="stream-info-bar">
      <div class="stream-title" id="streamTitle"></div>
      <div class="stream-meta" id="streamMeta"></div>
    </div>
  </div>

  <!-- RIGHT: CHAT -->
  <div class="stream-chat">
    <div class="chat-header">
      chat <span class="chat-status">● connected</span>
    </div>

    <div class="chat-body">
      <!-- позже сюда придёт реальный чат -->
    </div>

    <div class="chat-input">
      <input type="text" placeholder="Coming soon" disabled />
    </div>
  </div>
</div>

<header class="topbar">
  <div class="container topbar__inner">
    <div class="topbar__left">
      <div class="topbar__brand">
        <!-- FIX: logo is in repo root, not /img -->
        <img src="./fz-logo.png" alt="FZ">
        <span class="brand__name">Fightzone</span>
      </div>

      <nav class="topbar__nav">
        <a href="#" class="nav__item active" data-page="main">Main</a>
        <a href="#" class="nav__item" data-page="request">Request</a>
        <a href="#" class="nav__item" data-page="vip">VIP</a>
        <a href="#" class="nav__item" data-page="archive">Archive (VODs)</a>
        <a href="https://discord.gg/FyPCV9AaJf" class="nav__item" target="_blank" rel="noopener noreferrer">Discord</a>
      </nav>
    </div>

    <div class="topbar__search">
      <span class="search__icon">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none"
             xmlns="http://www.w3.org/2000/svg">
          <circle cx="11" cy="11" r="7" stroke="white" stroke-width="2"/>
          <line x1="16.65" y1="16.65" x2="21" y2="21" stroke="white" stroke-width="2" stroke-linecap="round"/>
        </svg>
      </span>
      <input type="text" placeholder="Search streams...">
    </div>
  </div>
</header>

<main class="container">

  <!-- ================= MAIN PAGE ================= -->
  <div class="page is-active" id="page-main">

    <section class="section">
      <h2 class="section__title section__title--live">
        <span class="liveDot"></span>
        Live
      </h2>

      <div class="noLiveBox">
        No events are live right now. Scroll down to see what's on later.
      </div>
    </section>

    <section class="section">
      <h2 class="section__title">UFC</h2>

      <div class="cards-wrap">
        <button class="cards-arrow cards-arrow--left" aria-label="Scroll left">‹</button>

        <div class="cards cards--1-wide">


          <div class="card"
            data-event="bautista"
            data-mode="early"
            data-start="2026-02-08T00:00:00"
            data-title="UFC: Bautista vs. Oliveira"
            data-meta="Sunday, Feb 8 · ESPN">
            <div class="card__media card__media--image card__media--bautista" style="background-image:url('./020726-ufc-fight-night-bautista-vs-oliveira-1024x576.jpg')"></div>
            <div class="card__footer">
              <div class="card__title">UFC: Bautista vs. Oliveira</div>
              <div class="card__meta">
                <span class="card__source">ESPN</span>
                <div class="card__right">
                  <div class="card__date">Sunday, Feb 8</div>
                  <div class="card__timer" id="ufc-timer-bautista">--</div>
                </div>
              </div>
            </div>
          </div>

          <div class="card"
            data-event="strickland"
            data-mode="strict"
            data-start="2026-02-22T00:00:00"
            data-title="UFC: Strickland vs Hernandez"
            data-meta="Sunday, Feb 22 · UFC">
            <div class="card__media card__media--image" style="background-image:url('./022126-ufc-fight-night-strickland-vs-hernandez-1024x576.jpg')"></div>
            <div class="card__footer">
              <div class="card__title">UFC: Strickland vs Hernandez</div>
              <div class="card__meta">
                <span class="card__source">ESPN</span>
                <div class="card__right">
                  <div class="card__date">Sunday, Feb 22</div>
                  <div class="card__timer" id="ufc-timer-strickland">--</div>
                </div>
              </div>
            </div>
          </div>

          <div class="card"
            data-event="moreno"
            data-mode="strict"
            data-start="2026-03-01T00:00:00"
            data-title="UFC: Moreno vs. Almabayev"
            data-meta="Sunday, Mar 1 · UFC">
            <div class="card__media card__media--image" style="background-image:url('./022826-ufc-fight-night-moreno-vs-almabayev-1024x576.jpg')"></div>
            <div class="card__footer">
              <div class="card__title">UFC: Moreno vs. Almabayev</div>
              <div class="card__meta">
                <span class="card__source">ESPN</span>
                <div class="card__right">
                  <div class="card__date">Sunday, Mar 1</div>
                  <div class="card__timer" id="ufc-timer-moreno">--</div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <button class="cards-arrow cards-arrow--right" aria-label="Scroll right">›</button>
      </div>
    </section>

    <section class="section">
      <h2 class="section__title">Boxing</h2>

      <div class="cards-wrap">
        <button class="cards-arrow cards-arrow--left" aria-label="Scroll left">‹</button>

        <div class="cards cards--1-wide">

          <div class="card"
               data-title="Boxing: Event 1"
               data-meta="Coming soon · Boxing">
            <div class="card__media card__media--image" style="background-image:url('./joshua-vs-fury-enhanced-1024x576.jpg')"></div>
            <div class="card__footer">
              <div class="card__title">Tyson Fury vs Anthony Joshua</div>
              <div class="card__meta">
                <span class="card__source">PTS</span>
                <div class="card__right">
                  <div class="card__date">Saturday, Mar 4</div>
                  <div class="card__timer" id="boxing-timer-1">--</div>
                </div>
              </div>
            </div>
          </div>

          <div class="card"
               data-title="Boxing: Event 2"
               data-meta="Coming soon · Boxing">
            <div class="card__media card__media--image" style="background-image:url('./makhmudov-vs-fury-1024x576.jpg')"></div>
            <div class="card__footer">
              <div class="card__title">Tyson Fury vs Arslanbek Makhmudov</div>
              <div class="card__meta">
                <span class="card__source">PTS</span>
                <div class="card__right">
                  <div class="card__date">Saturday, Apr 11</div>
                  <div class="card__timer" id="boxing-timer-2">--</div>
                </div>
              </div>
            </div>
          </div>

          <div class="card"
               data-title="Boxing: Event 3"
               data-meta="Coming soon · Boxing">
            <div class="card__media card__media--image" style="background-image:url('./barrios-vs-garcia-1024x576.jpg')"></div>
            <div class="card__footer">
              <div class="card__title">Mario Barrios vs. Ryan Garcia</div>
              <div class="card__meta">
                <span class="card__source">PTS</span>
                <div class="card__right">
                  <div class="card__date">Saturday, Feb 21</div>
                  <div class="card__timer" id="boxing-timer-3">--</div>
                </div>
              </div>
            </div>
          </div>

          <div class="card"
               data-title="Boxing: Event 4"
               data-meta="Coming soon · Boxing">
            <div class="card__media card__media--image" style="background-image:url('./wilder-vs-chisora-1024x576.jpg')"></div>
            <div class="card__footer">
              <div class="card__title">Tyson Fury vs. Derek Chisora</div>
              <div class="card__meta">
                <span class="card__source">PTS</span>
                <div class="card__right">
                  <div class="card__date">Saturday, Apr 4</div>
                  <div class="card__timer" id="boxing-timer-4">--</div>
                </div>
              </div>
            </div>
          </div>

        </div>

        <button class="cards-arrow cards-arrow--right" aria-label="Scroll right">›</button>
      </div>
    </section>

    <section class="section">
      <h2 class="section__title">American Football</h2>

      <div class="cards-wrap">
        <button class="cards-arrow cards-arrow--left" aria-label="Scroll left">‹</button>

        <div class="cards cards--1-wide">

          <div class="card card--coming-soon"
               data-title="NFL: Event 1"
               data-meta="Coming soon · NFL">
            <div class="card__media card__media--image" style="background-image:url('./patriots-vs-seahawks-1024x576.jpg')"></div>
            <div class="card__footer">
              <div class="card__title">Seattle Seahawks vs New England Patriots</div>
              <div class="card__meta">
                <span class="card__source">ASL</span>
                <div class="card__right">
                  <div class="card__date">TBA</div>

                </div>
              </div>
            </div>
          </div>

          <div class="card card--coming-soon"
               data-title="NFL: Event 2"
               data-meta="Coming soon · NFL">
            <div class="card__media card__media--image" style="background-image:url('./afc-vs-nfc-pro-bowl-1024x576.jpg')"></div>
            <div class="card__footer">
              <div class="card__title">NFC vs AFC</div>
              <div class="card__meta">
                <span class="card__source">ASL</span>
                <div class="card__right">
                  <div class="card__date">TBA</div>

                </div>
              </div>
            </div>
          </div>

        </div>

        <button class="cards-arrow cards-arrow--right" aria-label="Scroll right">›</button>
      </div>
    </section>


  </div>


  <!-- ================= REQUEST PAGE ================= -->
  <div class="page" id="page-request">
    <div class="request-wrap">
      <div class="request-stack">
<div class="request-card">
        <div class="request-head">
          <h2 class="request-title">Request</h2>
          <p class="request-sub">Tell us what event you want to watch.</p>
        </div>

        <div class="request-body">
          <form id="requestForm">
            <div class="form-row">
              <label class="form-label" for="reqEvent">Event name</label>
              <input class="form-input" id="reqEvent" name="event" type="text" placeholder="UFC / Boxing / Football..." />
              <div class="form-help">Example: “UFC 326”, “Fury vs Joshua”, “NFL Week 1”.</div>
            </div>

            <div class="form-row">
              <label class="form-label" for="reqLink">Link (optional)</label>
              <input class="form-input" id="reqLink" name="link" type="url" placeholder="https://..." />
            </div>

            <div class="form-row">
              <label class="form-label">Type</label>
              <div class="type-row">
                <label><input type="radio" name="type" value="ufc" checked /> UFC</label>
                <label><input type="radio" name="type" value="boxing" /> Boxing</label>
                <label><input type="radio" name="type" value="other" /> Other</label>
              </div>
            </div>

            <div class="request-actions">
              <button class="request-btn" type="submit">Send request</button>
            </div>
          </form>
        </div>
      </div>
<div class="request-card">
      <div class="request-head">
        <h1 class="request-title">How it works</h1>
        <p class="request-sub">
          1) Send a request<br />
          2) We check availability<br />
          3) If possible — we add it<br /><br />
          VIP members get priority.
        </p>
      </div>
      </div>
    </div>
  </div>



  </div>
<div class="page" id="page-vip">
    <div class="vip-wrap">
      <div class="vip-grid">

        <div class="vip-card">
          <h3 class="vip-card__title">UFC 325 - basic</h3>
          <div class="vip-price">
            <div class="vip-price__main">$5</div>
            <div class="vip-price__sub">/per stream</div>
          </div>
          <button class="vip-btn" type="button" data-stripe-url="https://buy.stripe.com/cNi14o1yf26CeUSaQzdIA0F">Select</button>
          <ul class="vip-features">
            <li>Access to only one event</li>
          </ul>
        </div>

        <div class="vip-card">
          <h3 class="vip-card__title">Fightzone Pass</h3>
          <div class="vip-price">
            <div class="vip-price__main">$10</div>
            <div class="vip-price__sub">/per month</div>
          </div>
          <button class="vip-btn" type="button" data-stripe-url="https://buy.stripe.com/8x23cwccTbHc2866AjdIA0H">Select</button>
          <ul class="vip-features">
            <li>ACCESS TO ALL STREAMS UFC/BOXING</li><li>HD+ Quality</li> <li>HIGHER DISCORD SUPPORT</li> <li>CHAT BOX </li> <li>ZERO ADS / POP UP ADS</li>
          </ul>
        </div>

        <div class="vip-card">
          <h3 class="vip-card__title">FightZone Elite Pass</h3>
          <div class="vip-price">
            <div class="vip-price__main">$25</div>
            <div class="vip-price__sub"></div>
          </div>
          <button class="vip-btn" type="button" data-stripe-url="https://buy.stripe.com/aFabJ2dgX26C1423o7dIA0I">Select</button>
          <ul class="vip-features">
            <li>ALL OF FZ PASS</li><li>ACCESS TO MYSTIC MAC BET BUILDERS/PICKS</li> <li>ACCESS TO VODS ON DEMAND STREAMS</li><li>ACCESS TO ALL STREAMS UFC/BOXING</li><li>HD+ Quality</li> <li>HIGHER DISCORD SUPPORT</li> <li>CHAT BOX </li> <li>ZERO ADS / POP UP ADS</li>
          </ul>
        </div>

      </div>
    </div>
  </div>

  <div class="page" id="page-archive">
    <div class="archive-empty">
      <div class="archive-icon">
        <svg viewBox="0 0 24 24" width="28" height="28" fill="none">
          <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2"/>
          <line x1="12" y1="10" x2="12" y2="16" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
          <circle cx="12" cy="7" r="1.5" fill="currentColor"/>
        </svg>
      </div>
      <div class="archive-text">Recordings of past events will be shown here</div>
    </div>
  </div>

  <div class="page" id="page-discord"></div>
</main>

<!-- Timers (all cards) -->
<script>
  const UFC_EVENTS = [
    { id: "ufc-timer-bautista", label: "Sunday, Feb 8", hour: 0, minute: 0 },
    { id: "ufc-timer-strickland", label: "Sunday, Feb 22", hour: 0, minute: 0 },
    { id: "ufc-timer-moreno", label: "Sunday, Mar 1", hour: 0, minute: 0 },
  ];

  const BOXING_EVENTS = [
    // date label is the exact text inside .card__date
    { id: "boxing-timer-1", label: "Saturday, Mar 4", hour: 0, minute: 0 },
    { id: "boxing-timer-2", label: "Saturday, Apr 11", hour: 0, minute: 0 },
    { id: "boxing-timer-3", label: "Saturday, Feb 21", hour: 0, minute: 0 },
    { id: "boxing-timer-4", label: "Saturday, Apr 4", hour: 0, minute: 0 },
  ];

  const ALL_EVENTS = [...UFC_EVENTS, ...BOXING_EVENTS];

  const MONTHS = {
    Jan: 0, Feb: 1, Mar: 2, Apr: 3, May: 4, Jun: 5,
    Jul: 6, Aug: 7, Sep: 8, Oct: 9, Nov: 10, Dec: 11
  };

  function parseDateFromLabel(label, hour = 0, minute = 0) {
    const trimmed = String(label || "").trim();

    // Year-only: "2026" -> Jan 1, 2026 00:00
    if (/^\d{4}$/.test(trimmed)) {
      const y = Number(trimmed);
      return new Date(y, 0, 1, hour, minute, 0, 0);
    }

    // "Saturday, Apr 11" (weekday optional, we just need "Apr 11")
    const m = trimmed.match(/,\s*([A-Za-z]{3})\s+(\d{1,2})\s*$/);
    if (!m) return null;

    const mon = MONTHS[m[1]];
    const day = Number(m[2]);
    if (mon === undefined || !day) return null;

    const now = new Date();
    let year = now.getFullYear();

    let d = new Date(year, mon, day, hour, minute, 0, 0);

    // if already passed, assume next year
    if (d.getTime() < now.getTime() - 60 * 1000) {
      year += 1;
      d = new Date(year, mon, day, hour, minute, 0, 0);
    }

    return d;
  }

  function formatDiff(ms) {
    if (ms <= 0) return "LIVE";

    const days = Math.floor(ms / (1000 * 60 * 60 * 24));
    const hours = Math.floor((ms / (1000 * 60 * 60)) % 24);
    const minutes = Math.floor((ms / (1000 * 60)) % 60);
    const seconds = Math.floor((ms / 1000) % 60);

    return `${days}d ${String(hours).padStart(2, "0")}h ${String(minutes).padStart(2, "0")}m ${String(seconds).padStart(2, "0")}s`;
  }

  function updateAllTimers() {
    const now = Date.now();

    ALL_EVENTS.forEach(evt => {
      const el = document.getElementById(evt.id);
      if (!el) return;

      const dateObj = parseDateFromLabel(evt.label, evt.hour ?? 0, evt.minute ?? 0);
      if (!dateObj) {
        el.textContent = "--";
        return;
      }

      const diff = dateObj.getTime() - now;
      el.textContent = formatDiff(diff);
    });
  }

  updateAllTimers();
  setInterval(updateAllTimers, 1000);
</script>



<!-- Nav switching (robust for mobile + desktop) -->
<script>
  (function(){
    const pages = {
      main: document.getElementById("page-main"),
      request: document.getElementById("page-request"),
      vip: document.getElementById("page-vip"),
      archive: document.getElementById("page-archive"),
      discord: document.getElementById("page-discord"),
    };

    function closeOverlaySafe(){
      const overlay = document.getElementById("streamOverlay");
      if (overlay) overlay.classList.remove("active");
      document.body.style.overflow = "";
      const v = document.getElementById("liveVideo");
      if (v) { try { v.pause(); } catch(e){} }
    }

    function setActivePage(key){
      Object.values(pages).forEach(p => p && p.classList.remove("is-active"));
      if (pages[key]) pages[key].classList.add("is-active");

      document.querySelectorAll(".nav__item[data-page]").forEach(a => {
        a.classList.toggle("active", a.dataset.page === key);
      });

      // always go to top after switching pages
      try { window.scrollTo({ top: 0, left: 0, behavior: "instant" }); }
      catch(e){ window.scrollTo(0,0); }
    }

    function onNavActivate(target, e){
      const href = target.getAttribute("href") || "";
      const isExternal = target.hasAttribute("target") || /^https?:\/\//i.test(href);
      if (isExternal) return;

      if (e){
        e.preventDefault();
        e.stopPropagation();
      }

      const key = target.dataset.page;
      if (!key) return;

      closeOverlaySafe();
      setActivePage(key);
    }

    function bind(){
      closeOverlaySafe();

      document.addEventListener("click", (e) => {
        const a = e.target.closest(".nav__item[data-page]");
        if (a) return onNavActivate(a, e);

        const brand = e.target.closest(".topbar__brand");
        if (brand){
          closeOverlaySafe();
          setActivePage("main");
          e.preventDefault();
          e.stopPropagation();
        }
      }, true);

      document.addEventListener("touchstart", (e) => {
        const a = e.target.closest(".nav__item[data-page]");
        if (a) return onNavActivate(a, e);

        const brand = e.target.closest(".topbar__brand");
        if (brand){
          closeOverlaySafe();
          setActivePage("main");
          e.preventDefault();
          e.stopPropagation();
        }
      }, { capture: true, passive: false });
    }

    document.addEventListener("DOMContentLoaded", bind);
  })();
</script>


<script>
  (function () {
    function setTopbarH() {
      const topbar = document.querySelector(".topbar");
      if (!topbar) return;
      const h = Math.ceil(topbar.getBoundingClientRect().height);
      document.documentElement.style.setProperty("--topbar-h", h + "px");
    }

    window.addEventListener("load", setTopbarH);
    window.addEventListener("resize", setTopbarH);
    setTopbarH();
  })();
</script>

<script>
  document.addEventListener("DOMContentLoaded", () => {
    const EPS = 2;

    document.querySelectorAll(".cards-wrap").forEach((wrap) => {
      const track = wrap.querySelector(".cards--1-wide");
      const leftBtn = wrap.querySelector(".cards-arrow--left");
      const rightBtn = wrap.querySelector(".cards-arrow--right");

      if (!track || !leftBtn || !rightBtn) return;

      const step = 326;

      function updateArrows() {
        const maxScrollLeft = track.scrollWidth - track.clientWidth;

        if (maxScrollLeft <= EPS) {
          leftBtn.classList.add("is-hidden");
          rightBtn.classList.add("is-hidden");
        } else {
          if (track.scrollLeft <= EPS) leftBtn.classList.add("is-hidden");
          else leftBtn.classList.remove("is-hidden");

          if (track.scrollLeft >= maxScrollLeft - EPS) rightBtn.classList.add("is-hidden");
          else rightBtn.classList.remove("is-hidden");
        }

        wrap.classList.toggle("has-left-fade", track.scrollLeft > EPS);
        wrap.classList.toggle("has-right-fade", track.scrollLeft < maxScrollLeft - EPS);
      }

      leftBtn.addEventListener("click", () => {
        track.scrollBy({ left: -step, behavior: "smooth" });
      });

      rightBtn.addEventListener("click", () => {
        track.scrollBy({ left: step, behavior: "smooth" });
      });

      track.addEventListener("scroll", () => requestAnimationFrame(updateArrows));
      window.addEventListener("resize", () => requestAnimationFrame(updateArrows));

      updateArrows();
    });
  });
</script>

<script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
<script>
  const STREAM_SRC = "https://resource-wedding-patients-searching.trycloudflare.com/hls/stream.m3u8";                                           

  function formatDiff(ms) {
    if (ms <= 0) return "LIVE";
    const days = Math.floor(ms / (1000 * 60 * 60 * 24));
    const hours = Math.floor((ms / (1000 * 60 * 60)) % 24);
    const minutes = Math.floor((ms / (1000 * 60)) % 60);
    const seconds = Math.floor((ms / 1000) % 60);
    return `${days}d ${String(hours).padStart(2,"0")}h ${String(minutes).padStart(2,"0")}m ${String(seconds).padStart(2,"0")}s`;
  }

  function getEventStart(card) {
    const s = card?.dataset?.start;
    const d = s ? new Date(s) : null;
    return (d && !isNaN(d.getTime())) ? d : null;
  }

  async function isStreamLive() {
    const ctrl = new AbortController();
    const t = setTimeout(() => ctrl.abort(), 3000);

    try {
      const res = await fetch(STREAM_SRC, { cache: "no-store", signal: ctrl.signal });
      if (!res.ok) return false;
      const txt = await res.text();
      return txt.includes("#EXTM3U") && (txt.includes("#EXTINF") || txt.includes("#EXT-X-TARGETDURATION"));
    } catch (e) {
      return false;
    } finally {
      clearTimeout(t);
    }
  }

  function showTapToPlay(show) {
    const tap = document.getElementById("tapToPlay");
    if (!tap) return;
    tap.classList.toggle("is-on", !!show);
  }

  function startVideo() {
    const video = document.getElementById("liveVideo");
    if (!video) return;

    if (window.__hls_inited) {
      video.play().then(() => showTapToPlay(false)).catch(() => showTapToPlay(true));
      return;
    }

    window.__hls_inited = true;

    if (window.Hls && Hls.isSupported()) {
      const hls = new Hls({ lowLatencyMode: false, backBufferLength: 90 });
      hls.loadSource(STREAM_SRC);
      hls.attachMedia(video);

      hls.on(Hls.Events.MANIFEST_PARSED, () => {
        video.play().then(() => showTapToPlay(false)).catch(() => showTapToPlay(true));
      });

      window.__hls_instance = hls;
    } else if (video.canPlayType("application/vnd.apple.mpegurl")) {
      video.src = STREAM_SRC;
      video.play().then(() => showTapToPlay(false)).catch(() => showTapToPlay(true));
    }
  }

  function stopVideo() {
    const v = document.getElementById("liveVideo");
    if (v) {
      try { v.pause(); } catch(e) {}
    }
    showTapToPlay(false);
  }

  function setPlaceholder(on, titleText, timerText, subText) {
    const ph = document.getElementById("streamPlaceholder");
    const t  = document.getElementById("phTitle");
    const tm = document.getElementById("phTimer");
    const s  = document.getElementById("phSub");

    if (!ph) return;

    if (on) ph.classList.add("is-on");
    else ph.classList.remove("is-on");

    if (t && titleText != null) t.textContent = titleText;
    if (tm && timerText != null) tm.textContent = timerText;
    if (s && subText != null) s.textContent = subText;
  }

  let overlayPollTimer = null;
  let overlayCountdownTimer = null;
  let activeCard = null;

  async function applyOverlayState(card) {
    const mode = card?.dataset?.mode || "strict"; // early | strict
    const start = getEventStart(card);

    const now = Date.now();
    const startMs = start ? start.getTime() : null;
    const beforeStart = (startMs != null) ? (now < startMs) : true;

    if (beforeStart) {
      const diff = startMs != null ? (startMs - now) : 0;
      setPlaceholder(true, "This event is not live yet", formatDiff(diff), "Come back when the timer ends");
    } else {
      setPlaceholder(true, "Starting soon", "00d 00h 00m 00s", "Waiting for the stream to start");
    }

    const live = await isStreamLive();

    const canShow =
      (mode === "early")
        ? live
        : (!beforeStart && live);

    if (canShow) {
      setPlaceholder(false);
      startVideo();
    } else {
      stopVideo();
    }
  }

  function startOverlayTimers(card) {
    clearInterval(overlayCountdownTimer);
    overlayCountdownTimer = setInterval(() => {
      const start = getEventStart(card);
      if (!start) return;

      const now = Date.now();
      const diff = start.getTime() - now;

      const ph = document.getElementById("streamPlaceholder");
      if (ph && ph.classList.contains("is-on") && diff > 0) {
        const tm = document.getElementById("phTimer");
        if (tm) tm.textContent = formatDiff(diff);
      }
    }, 1000);

    clearInterval(overlayPollTimer);
    overlayPollTimer = setInterval(() => {
      if (!activeCard) return;
      applyOverlayState(activeCard);
    }, 5000);
  }

  function openOverlayFromCard(card) {
    activeCard = card;

    const title = card?.dataset?.title || "Live stream";
    const meta  = card?.dataset?.meta  || "";
    const t = document.getElementById("streamTitle");
    const m = document.getElementById("streamMeta");
    if (t) t.textContent = title;
    if (m) m.textContent = meta;

    const overlay = document.getElementById("streamOverlay");
    if (overlay) overlay.classList.add("active");
    document.body.style.overflow = "hidden";

    applyOverlayState(card);
    startOverlayTimers(card);
  }

  function closeOverlay() {
    const overlay = document.getElementById("streamOverlay");
    if (overlay) overlay.classList.remove("active");
    document.body.style.overflow = "";

    clearInterval(overlayPollTimer);
    clearInterval(overlayCountdownTimer);
    overlayPollTimer = null;
    overlayCountdownTimer = null;
    activeCard = null;

    stopVideo();
    setPlaceholder(false);
  }

  // expose for nav script
  window.closeOverlay = closeOverlay;

  document.addEventListener("DOMContentLoaded", () => {
    document.querySelectorAll(".card").forEach(card => {
      card.addEventListener("click", () => openOverlayFromCard(card));
    });

    document.addEventListener("keydown", (e) => {
      if (e.key === "Escape") closeOverlay();
    });

    const overlay = document.getElementById("streamOverlay");
    if (overlay) {
      overlay.addEventListener("click", (e) => {
        if (e.target === overlay) closeOverlay();
      });
    }

    const tapBtn = document.getElementById("tapToPlayBtn");
    if (tapBtn) {
      tapBtn.addEventListener("click", () => {
        const v = document.getElementById("liveVideo");
        if (!v) return;
        v.muted = false;
        v.play().then(() => showTapToPlay(false)).catch(() => showTapToPlay(true));
      });
    }
  });
</script>


<script>
  // Request form: prevent page reload (no backend yet)
  document.addEventListener("DOMContentLoaded", () => {
    const form = document.getElementById("requestForm");
    if (!form) return;
    form.addEventListener("submit", (e) => {
      e.preventDefault();
      // TODO: connect to backend / email / Discord webhook
      alert("Request sent!");
      form.reset();
    });
  });
</script>

<!-- VIP buttons -> Stripe -->
<script>
  document.addEventListener("DOMContentLoaded", () => {
    document.querySelectorAll(".vip-btn[data-stripe-url]").forEach((btn) => {
      btn.addEventListener("click", () => {
        const url = btn.getAttribute("data-stripe-url");
        if (url) window.location.href = url;
      });
    });
  });
</script>

</body>
</html>

